<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta charset="utf-8" />
    <title>Đăng nhập - Phenikaa University</title>
    <link rel="stylesheet" href="globals.css" />
    <link rel="stylesheet" href="styleguide.css" />
    <link rel="stylesheet" href="style.css" />
  </head>

  <body>
    <main class="login">
      <div class="overlap-wrapper">
        <div class="overlap">
          <section class="right">
            <div class="overlap-group">
              <div class="rectangle"></div>
              <img
                class="group"
                src="https://c.animaapp.com/mewurn4ndN2M6v/img/group-5.png"
                alt="Social media icons"
              />
              <form class="login-form" novalidate>
                <div class="logo-container">
                  <img
                  class="logo"
                  src="PTTK/Sec_Edunera_Logo_512.png"
                  alt="Logo"
                  />
                </div>
                <div class="div-wrapper">
                  <div class="div">
                    <div class="rectangle-5"></div>
                    <label class="text-wrapper-2" for="username"
                      >Tên đăng nhập *</label
                    >
                    <input
                      type="text"
                      id="username"
                      name="username"
                      class="username-input"
                      required
                      aria-describedby="username-error"
                      autocomplete="username"
                    />
                  </div>
                </div>
                <div class="overlap-group-wrapper">
                  <div class="div">
                    <div class="rectangle-3"></div>
                    <label class="text-wrapper-2" for="password"
                      >Mật khẩu *</label
                    >
                    <input
                      type="password"
                      id="password"
                      name="password"
                      class="password-input"
                      required
                      aria-describedby="password-error"
                      autocomplete="current-password"
                    />
                  </div>
                </div>
                <nav class="auth-links">
                  <a href="#" class="text-wrapper-9">Đổi mật khẩu</a>
                  <a href="#" class="text-wrapper-4">Quên mật khẩu?</a>
                </nav>
                <button type="submit" class="button">
                  Đăng nhập
                </button>
              </form>
              <footer class="footer-info">
                <p class="p">
                  Copyright © 2025. Edunera. All rights. Developed
                  by Group 6
                </p>
              </footer>
            </div>
          </section>
          <section class="left">
            <div class="overlap-2">
              <div class="rectangle-9"></div>
              <img
                class="students-pana"
                src="https://c.animaapp.com/mewurn4ndN2M6v/img/students-pana-fba09de9-1.svg"
                alt="Students illustration"
              />
              <header class="hero-text">
                <h1 class="text-wrapper-7">Phân tích thiết kế phần mềm</h1>
                <h2 class="text-wrapper-8">Nhóm 6</h2>
                <h3 class="text-wrapper-6">Quản lý đào tạo ứng dụng hệ thống điểm danh khuôn mặt</h3>
              </header>
            </div>
          </section>
        </div>
      </div>
    </main>

    <script>
      document
        .querySelector(".login-form")
        .addEventListener("submit", async function (event) {
          event.preventDefault();

          const username = document.getElementById("username").value;
          const password = document.getElementById("password").value;
          const role = document.getElementById("role-select").value;

          try {
            const response = await fetch("http://127.0.0.1:8000/auth/login", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ username, password, role }),
            });

            if (!response.ok) {
              throw new Error("Sai tài khoản hoặc mật khẩu!");
            }

            const data = await response.json();
            console.log("Đăng nhập thành công:", data);

            // Lưu token để dùng cho request sau
            localStorage.setItem("token", data.access_token);

            // Chuyển hướng theo role
            if (role === "admin") {
              window.location.href = "/frontend/Admin/navbar.html";
            } else if (role === "student") {
              window.location.href = "/frontend/Student/student_dashboard.html";
            } else if (role === "teacher") {
              window.location.href = "/frontend/Teacher/teacher_dashboard.html";
            } else {
              alert("Không tìm thấy trang cho vai trò này!");
            }
          } catch (err) {
            alert(err.message);
          }
        });
    </script>
  </body>
</html>
